---
title: Effective C++ (ç¬¬3ç‰ˆ) ç²¾è¯»æ€»ç»“ [1]
subtitle: æ”¹å–„ç¨‹åºä¸è®¾è®¡çš„55ä¸ªå…·ä½“åšæ³•(Rule01-12)
date: 2023-07-29T18:51:19+08:00
draft: false
author:
  name: Jian YE
  link:
  email: 18817571704@163.com
  avatar:
description:
keywords:
license:
comment: false
weight: 0
tags:
  - Effective
categories:
  - C++
hiddenFromHomePage: false
hiddenFromSearch: false
summary:
resources:
  - name: featured-image
    src: featured-image.jpg
  - name: featured-image-preview
    src: featured-image-preview.jpg
toc: true
math: true
lightgallery: false
---

<!--more-->
# åºè¨€

è¿™æœ¬C++çš„ç»å…¸ä¹‹ä½œï¼Œä½œè€…æ˜¯å¤§ä½¬`Scott Meyers`ğŸ‘‰[å¤§ä½¬ä¸»é¡µ](https://www.aristeia.com/books.html)ï¼Œè¿˜å†™è¿‡å…¶ä»–å‡ æœ¬å½±å“æ·±è¿œçš„C++ç»å…¸ï¼Œä¾‹å¦‚`ã€ŠEffective STLã€‹`,`ã€ŠMore Effective C++ã€‹`,`ã€ŠEffective Mordern C++ã€‹`,`ã€ŠOverview of the New C++(C++11/14)ã€‹`ç­‰ç­‰ã€‚æœ¬äººçœ‹çš„æ˜¯ä¸­æ–‡ç‰ˆï¼Œä¾¯æ·è€å¸ˆç¿»è¯‘çš„ï¼Œç²¾è¯»åˆ†æå¹¶å®è·µæ¨æ•²åï¼Œæ•´ç†æˆåšå®¢è®°å½•ä¸‹æ¥ã€‚

> (Effective-C++æ€»ç»“ç³»åˆ—åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸€éƒ¨åˆ†ï¼Œæ¶‰åŠåŸä¹¦ç¬¬1~2ç« ï¼Œå†…å®¹èŒƒå›´Rule01~12ã€‚ä¸ºæ–¹ä¾¿ä¹¦å†™ï¼ŒRule01ç®€å†™ä¸ºR01)ã€‚

{{< admonition Note "Effective-C++ç³»åˆ—List" false >}}
æœ¬åšå®¢ç«™ç‚¹ç³»åˆ—å†…å®¹å¦‚ä¸‹ï¼š</br>
ğŸ’¡ [Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸€)](https://jianye0428.github.io/posts/partone/)</br>
ğŸ’¡ [Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(äºŒ)](https://jianye0428.github.io/posts/parttwo/)</br>
ğŸ’¡ [Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(ä¸‰)](https://jianye0428.github.io/posts/partthree/)</br>
ğŸ’¡ [Effective C++(ç¬¬3ç‰ˆ)ç²¾è¯»æ€»ç»“(å››)](https://jianye0428.github.io/posts/partfour/)</br>
{{< /admonition >}}

## CH1.è®©è‡ªå·±ä¹ æƒ¯C++

### R01 è§†C++ä¸ºä¸€ä¸ªè¯­è¨€è”é‚¦

å¦‚ä»Šçš„C++å·²ç»æ˜¯ä¸ªå¤šé‡èŒƒå¼(multiparadigm)è¯­è¨€ï¼ŒåŒæ—¶æ”¯æŒé¢å‘è¿‡ç¨‹å½¢å¼ã€é¢å‘å¯¹è±¡å½¢å¼ã€å‡½æ•°å½¢å¼ã€æ³›å‹å½¢å¼ã€å…ƒç¼–ç¨‹å½¢å¼ã€‚ è¦ç†è§£è¿™ä¹ˆå¤šç‰¹æ€§ï¼Œå¯ä»¥ç®€å•çš„å½’ç»“ä¸º`å››ç§æ¬¡è¯­è¨€`(sublanguage)ç»„æˆï¼š

- **Cè¯­è¨€:** `C++ä»ä»¥Cä¸ºåŸºç¡€`ã€‚C++æ˜¯Cçš„è¶…é›†, ä»ç„¶ä»¥ C ä¸ºåŸºç¡€ã€‚<font color=green>åŒºå—</font>ã€<font color=green>è¯­å¥</font>ã€<font color=green>é¢„å¤„ç†å™¨</font>ã€<font color=green>å†…ç½®æ•°æ®ç±»å‹</font> ã€<font color=green>æ•°ç»„</font>ã€<font color=green>æŒ‡é’ˆ</font>ç­‰ç»Ÿç»Ÿæ¥è‡ªCï¼Œè®¸å¤šæ—¶å€™C++å¯¹é—®é¢˜çš„è§£å†³å…¶å®ä¸è¿‡å°±æ˜¯è¾ƒé«˜çº§çš„ C è§£æ³•ï¼Œä½†å½“ä½ C++å†…çš„ C æˆåˆ†å·¥ä½œæ—¶ï¼Œé«˜æ•ˆç¼–ç¨‹å®ˆåˆ™æ˜ ç…§å‡º C è¯­è¨€çš„<font color=red>å±€é™</font>ï¼šæ²¡æœ‰æ¨¡æ¿(template) ï¼Œæ²¡æœ‰å¼‚å¸¸(exceptions)ï¼Œæ²¡æœ‰é‡è½½(overloading)â€¦â€¦
- **Object-Oriented C++:** é¢å‘å¯¹è±¡ç‰¹æ€§ã€‚è¿™éƒ¨åˆ†ä¹Ÿå°±æ˜¯ C with classes æ‰€è¯‰æ±‚çš„: **classes**(åŒ…æ‹¬æ„é€ å‡½æ•°å’Œææ„å‡½æ•°)ï¼Œ**å°è£…**(encapsulation)ã€**ç»§æ‰¿**(inheritance)ã€**å¤šæ€**(polymorhpism)ã€**virtualå‡½æ•°**(åŠ¨æ€ç»‘å®š)â€¦â€¦ç­‰ç­‰ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¹‹å¤å…¸å®ˆåˆ™åœ¨C++ ä¸Šçš„ç›´æ¥å®æ–½ã€‚
- **Template C++:** C++çš„æ³›å‹(generic)ç¼–ç¨‹çš„éƒ¨åˆ†ï¼Œä¹Ÿå¸¦æ¥äº†é»‘é­”æ³•-æ¨¡æ¿å…ƒç¼–ç¨‹(TMP,Metaprogramming)ï¼›
- **STLï¼š** STL(Standard Temlate Library)å³æ ‡å‡†æ¨¡æ¿åº“ï¼Œå®ƒæ˜¯templateç¨‹åºåº“ã€‚å°è£…äº†å„ç±»å®¹å™¨(container)ã€é…ç½®å™¨(allocator)ã€è¿­ä»£å™¨(iterator)ã€ç®—æ³•ä»¥åŠå¸¸ç”¨å¯¹è±¡ã€‚

**æ€»ç»“:**
C++é«˜æ•ˆç¼–ç¨‹å®ˆåˆ™è§†çŠ¶å†µè€Œå˜åŒ–ï¼Œå–å†³äºä½ ä½¿ç”¨C++çš„å“ªä¸€éƒ¨åˆ†

### R02 å°½é‡ä»¥`const`,`enum`,`inline`æ›¿æ¢`#define`

- **å¯¹äºå®å®šä¹‰çš„å¸¸é‡ï¼Œå»ºè®®ç”¨constå¸¸é‡æˆ–è€…æšä¸¾enumæ›¿æ¢**
  è¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºå®æŠ¥é”™å°±æ˜¯ä¸ªå¸¸æ•°å€¼ï¼Œæ²¡æœ‰ç¬¦å·è¡¨ï¼›å¹¶ä¸”å®ä¸å…·æœ‰å°è£…æ€§(å®çš„ä½œç”¨åŸŸæ˜¯åœ¨ç¼–è¯‘æ—¶æ˜¯å…¶å®šä¹‰ä¹‹äº‹)ã€‚
  ```c++
  // ä¸¾ä¾‹ï¼šMAX_DATA_COUNTåœ¨é¢„å¤„ç†é˜¶æ®µå°±ä¼šè¢«æ›¿æ¢ï¼Œç¼–è¯‘å™¨ä¸ä¼šè§åˆ°å®ƒï¼Œæ‰€ä»¥ä¸€æ—¦æœ‰ç›¸å…³æŠ¥é”™ï¼Œç»™çš„æ˜¯100è¿™ä¸ªå€¼
  #define MAX_DATA_COUNT   100
  const int MAX_DATA_COUNT = 100 ;// å¸¸é‡åªæœ‰ä¸€ä»½ï¼Œå®ä¼šå¯¼è‡´å¤šä»½å¸¸é‡å€¼
  class Buffer{
  public://...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
      static const double factor_ ;// staticå¸¸é‡,ç±»å†…å£°æ˜
      static const int  times_ = 2;// intç±»å‹å…è®¸ç±»å†…åˆå§‹åŒ–,è§„èŒƒä¸Šè¿˜æ˜¯å»ºè®®æ‹¿åˆ°ç±»å¤–
  private:
      static const int ArrLength = 5;
      int arr[ArrLength];
  };
  const double Buffer::factor_  = 0.1;// ç±»å¤–åˆå§‹åŒ–,ä¸€èˆ¬å†™åœ¨å®ç°æ–‡ä»¶*.cpp,*.ccä¸­
  ```
  å¦‚æœç¼–è¯‘å™¨ä¸å…è®¸å£°æ˜æ—¶"in-classåˆå€¼è®¾å®š",å¦‚æœæ˜¯æ•´å½¢å¸¸é‡ï¼Œå¯ä»¥è®©æšä¸¾å€¼æ¥æ›¿ä»£ï¼Œè€Œä¸”<font color=red>`æšä¸¾å€¼ä¸èƒ½è¢«å–åœ°å€`</font>ã€‚
- **å¯¹äºå®å®šä¹‰çš„å‡½æ•°ï¼Œå»ºè®®ç”¨å†…è”inlineå‡½æ•°æ›¿æ¢**
  å®å‡½æ•°æ²¡åŠæ³•å•è¡Œdebugè°ƒè¯•ï¼Œè€Œå†…è”å‡½æ•°å¯ä»¥ï¼›
  å®çš„å†™æ³•å³ä½¿å°å¿ƒç¿¼ç¿¼çš„åŠ å¥½äº†æ‹¬å·ï¼Œä¹Ÿå¯èƒ½é€ æˆæ„æƒ³ä¸åˆ°çš„<font color=red>`å®å‡½æ•°é‡å¤è®¡ç®—`</font>çš„é—®é¢˜ã€‚
  ```c++
  #define  GET_MAX(a,b)   ((a)>(b) ? (a) :(b))
  int a = 5, b = 0;
  GET_MAX(++a,b);    // aç´¯åŠ äºŒæ¬¡
  GET_MAX(++a,b+10); // aç´¯åŠ ä¸€æ¬¡
  // å®šä¹‰ä¸ªinlineå‡½æ•°å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜,(a,b)ä½œä¸ºå‡½æ•°å…¥å‚å°±åªä¼šè®¡ç®—ä¸€æ¬¡
  ```
  {{<admonition Note "By the way">}}
  ä¸Šè¿°æƒ…å†µï¼Œä»çº¯Cè¯­è¨€è§’åº¦ï¼Œæƒ³é¿å…â€œå®å‡½æ•°é‡å¤è®¡ç®—â€ï¼Œå…¶å®è¿˜æœ‰ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨GNU C æ‰©å±•çš„ typeof æˆ– GCC çš„ `__auto_type` å…³é”®å­—ï¼Œè¯¦ç»†å¯å‚è€ƒGCCå®˜æ–¹æ–‡æ¡£é¡µé¢ã€‚2è€…éƒ½é€‚ç”¨äºGCCå’ŒClangï¼Œéƒ½ä¸é€‚ç”¨MSVCï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
  ```c
  #define  GET_MAX_ONCE(a,b) \
        ( {typeof(a) _a = (a);   \
           typeof(b) _b = (b);   \
           (_a) > (_b) ? (_a) : (_b); } )
  ```

  æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š
  ```C
  int a = 10,b = 20;
  int c = GET_MAX(++a, b++);
  std::cout << "a = " << a << ", b = "<< b << ", c = " << c << std::endl;
  a = 10 , b = 20;
  c = GET_MAX_ONCE(++a, b++);
  std::cout << "a = " << a << ", b = "<< b << ", c = " << c << std::endl;
  ```

  æµ‹è¯•ä»£ç è¾“å‡ºï¼š
  ```shell
  a = 11, b = 22, c = 21
  a = 11, b = 21, c = 20
  ```
  > ğŸ¤” `ä½¿ç”¨ __auto_type` æ¥å–ä»£æ—¶è¦èµ‹åˆå€¼ï¼Œå…³é”®çš„ typeof é‚£è¡Œç”¨æ³•æ”¹ä¸º`__auto_type _a = (a);` ã€‚
  >__auto_type æ¯” typeof çš„ä¼˜åŠ¿ä¹‹å¤„åœ¨äºé¢å¯¹å˜é•¿æ•°ç»„(VLA)ï¼Œåªè§£æ1æ¬¡ï¼›ä»¥åŠé¢å¯¹åµŒå¥—å®å®šä¹‰æ—¶ä¹Ÿæ˜¯åªä¸¥æ ¼è§£æä¸€æ¬¡ã€‚

  {{</admonition>}}


### R03 å°½å¯èƒ½ç”¨const

è¯´èµ·constï¼Œå…ˆå¤ä¹ ä¸ªé¢è¯•é«˜é¢‘é¢˜ğŸ˜
```c++
//ç±»å‹charåœ¨å“ªé‡Œæ²¡å…³ç³»ï¼Œå…³é”®çœ‹constå’Œ*çš„ç›¸å¯¹ä½ç½®ï¼š
  //conståœ¨*å·¦è¾¹ï¼ŒæŒ‡é’ˆæ‰€æŒ‡ç‰©ä¸ºå¸¸é‡;
  //conståœ¨*å³è¾¹ï¼ŒæŒ‡é’ˆä¸ºå¸¸é‡ï¼›
const char* p; // æŒ‡é’ˆpæ‰€æŒ‡çš„å­—ç¬¦ä¸²ä¸ºå¸¸é‡ï¼Œä½†æ˜¯på¯ä»¥ä¿®æ”¹
char* const p; // æŒ‡é’ˆpæ˜¯å¸¸é‡ï¼ŒæŒ‡å‘çš„å­—ç¬¦ä¸²å¯ä¿®æ”¹
```
  - constä¿®é¥°å‡½æ•°è¿”å›å€¼æ—¶çš„é˜²å¾¡æ€§
    constä¿®é¥°å‡½æ•°çš„è¿”å›å€¼ï¼Œå¯ä»¥é¿å…ä¸€äº›é”™è¯¯ï¼Œå¦‚ä¸‹ï¼š
    ```c++
    const Rational operator* (const Rational& lhs,const Rational& rhs);
    //å­˜åœ¨Rational a,b,c;
    if(a*b = c) //ä¾‹å¦‚æ‰‹è¯¯ "=="æ‰“æˆäº†"="ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™
    ```
  - constæˆå‘˜å‡½æ•°çš„é™åˆ¶
    constæˆå‘˜å‡½æ•°æœ‰2ä¸ªå¥½å¤„ï¼š(1). æ˜ç¡®ç†è§£å‡½æ•°æ˜¯å¦ä¿®æ”¹å¯¹è±¡å†…å®¹ï¼›(2). ä½¿â€œæ“ä½œconstå¯¹è±¡â€æˆä¸ºå¯èƒ½ã€‚
    å¯ä»¥é€šè¿‡constç‰¹æ€§è®©å¯¹è±¡è‡ªåŠ¨è°ƒç”¨æ­£ç¡®çš„ç‰ˆæœ¬ï¼š
    ```c++
    class TextBlock{//...ç±»å…¶ä»–éƒ¨åˆ†çœç•¥
      const char& operator[](std::size_t index) const{ return text[index];}
      char& operator[](std::size_t index) { return text[index];}
    private:
        std::string text;
    }
    void print(const TextBlock& ctb){
        std::cout << ctb[0] ;//æ ¹æ®constç‰¹æ€§ï¼Œè°ƒç”¨ const TextBlock::operator[]
    }
    ```
    æ€è€ƒï¼šconstæˆå‘˜å‡½æ•°ä¸ä¿®æ”¹æˆå‘˜å¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆå‘˜å¯¹è±¡ä¸ºæŒ‡é’ˆ`char *p`ï¼Œä»…ä¿®æ”¹`p`æŒ‡å‘çš„å†…å®¹ï¼Œé‚£å®ƒè¿˜æ˜¯`const`æˆå‘˜å‡½æ•°å—ï¼Ÿ
    å®æµ‹ï¼šconstæˆå‘˜å‡½æ•°æ˜¯å…è®¸`p[2]= 'x'`è¿™ä¸€æ“ä½œçš„ï¼Œä½†æ˜¯ä¸å…è®¸p++ï¼›
    - `bitwise-constness`(åˆç§°ä¸ºphysical constness)ç†å¿µè®¤ä¸ºä¸æ˜¯ï¼Œä¸èƒ½æ›´æ”¹ä»»ä½•å¯¹è±¡å†…çš„ä»»ä½•ä¸€ä¸ªbitã€‚è¿™ç§è¯´æ³•ä¹Ÿæœ‰çº°æ¼ï¼Œconstå‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨å°±å¤±æ§äº†,å¤–éƒ¨å¯æ”¹ï¼›
    - `logical-constness`ç†å¿µåˆ™å…è®¸constæˆå‘˜å‡½æ•°ä¿®æ”¹æˆå‘˜å˜é‡çš„bitsï¼Œä½†åªæœ‰åœ¨å®¢æˆ·ç«¯ä¾¦æµ‹ä¸å‡ºçš„æƒ…å†µä¸‹;
    - `constæˆå‘˜å‡½æ•°`å¦‚æœä¸€å®šè¦ä¿®æ”¹æˆå‘˜å˜é‡ï¼Œæˆå‘˜å˜é‡ä½¿ç”¨ `mutable` ä¿®é¥°å³å¯.
  - constä¸non-constçš„æˆå‘˜å‡½æ•°å®ç°å®Œå…¨ç›¸åŒæ—¶
  è¿™ç§æƒ…å†µï¼Œå¦‚ä½•å»é™¤ä»£ç å†—ä½™æ˜¯ä¸ªé—®é¢˜ã€‚ä¸è¦å°è£…å‡ºä¸€ä¸ªprivateå‡½æ•°ç„¶åä¸€èµ·è°ƒç”¨ï¼Œå¤šäº†å±‚è°ƒç”¨ã€‚
  æ­£ç¡®åšæ³•ğŸ‘‰ `ä½¿ç”¨è½¬å‹,è®©non-constè°ƒç”¨constæˆå‘˜å‡½æ•°`ï¼Œå¦‚ä¸‹ä¸ºç¤ºä¾‹ï¼š
  ```c++
  class Rawdata {
  public:
      Rawdata(char *src):p_(src),length_(strlen(src)) {}
      const int& GetLength()const{
          p_[1] = 'a';//ä¸ºæ±‚ç®€ä¾¿,ä¸ä½œæ£€æŸ¥äº†ã€‚p_å†…å®¹ä¿®æ”¹ç¼–è¯‘å™¨æ˜¯å…è®¸çš„.
          return length_;
      }
      int GetLength() {
          return const_cast<int&>(
              (static_cast<const Rawdata&>(*this)).GetLength());
      }
  private:
      char *p_ = nullptr;
      int length_ = 0;
  };
  ```

### R04 ç¡®å®šå¯¹è±¡ä½¿ç”¨å‰å…ˆåˆå§‹åŒ–

åˆ†æ¸…"èµ‹å€¼"å’Œ"åˆå§‹åŒ–"ï¼Œåœ¨ç±»çš„æ„é€ å‡½æ•°ä½“å†…ä½¿ç”¨ç­‰å·"="èµ‹å€¼å¹¶é"åˆå§‹åŒ–â€ã€‚æˆå‘˜å˜é‡çš„åˆå§‹åŒ–æ˜¯åœ¨æ„é€ å‡½æ•°çš„<u>æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</u>å®ç°ï¼Œæ•ˆç‡æ›´é«˜ã€‚

`C++åˆå§‹åŒ–çš„æ¬¡åº:`
1. Base classæ€»æ˜¯æ—©äºDerived Classè¢«åˆå§‹åŒ–ï¼›
2. Classå†…çš„æˆå‘˜å˜é‡æ€»æ˜¯ä»¥å£°æ˜æ¬¡åºè¢«åˆå§‹åŒ–ï¼›
   ä¸¾ä¾‹: ä¸‹å›¾ä¸­çš„ä»£ç åˆå§‹åŒ–é¡ºåºä¸ºå£°æ˜é¡ºåº"age_$\rightarrow$name_$\rightarrow$gender_ $\rightarrow$isVip_"
   ```c++
    class Customer {
    public: //è¿™é‡Œåªæ˜¯ä¸ºäº†éªŒè¯ï¼Œå¦‚æœæ˜¯å®é™…å·¥ç¨‹ä»£ç ï¼Œå»ºè®®åˆå€¼åˆ—è¡¨å°½é‡å’Œå£°æ˜é¡ºåºä¿æŒä¸€è‡´
        Customer(std::string gender, uint8_t age, std::string name, bool isVip = false)
            :isVip_(isVip), gender_(gender), name_(name), age_(age) {}
    private:
        uint8_t age_;
        std::string name_;
        std::string gender_;
        bool isVip_;
    };
   ```
   {{<admonition Note "By the way">}}
    ğŸ’¡ï¼šä»»ä½•ä¸€ä¸ªæˆå‘˜å˜é‡açš„åˆå§‹åŒ–æµç¨‹ï¼šç±»å†…å£°æ˜èµ‹åˆå€¼(C++11)->æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨->æ„é€ å‡½æ•°ä½“å†…èµ‹å€¼.
   {{</admonition>}}
3. å‡½æ•°ä½“å¤–staticå˜é‡ç§°ä¸º`non-local static`å˜é‡ï¼Œè¿™ç§å˜é‡å¯ä»¥åœ¨å„è‡ªçš„ç¼–è¯‘å•å…ƒæ­£å¸¸å·¥ä½œï¼Œä½†C++æ— æ³•ä¿è¯åˆå§‹åŒ–æ¬¡åºï¼Œå½“ç¼–è¯‘å•å…ƒä¹‹é—´éœ€è¦å…±äº«å˜é‡æ—¶ï¼Œè€Œè¯¥å˜é‡ä¾èµ–non-local staticï¼Œå°±å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚
**è§£å†³åŠæ³•**æ˜¯å°†è¿™æ ·çš„å˜é‡æ”¾å›å‡½æ•°ä½“å†…ï¼Œæˆä¸ºlocal staticï¼Œå› ä¸ºC++ç¡®ä¿åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ä¸€å®šä¼šåˆå§‹åŒ–è¿™ä¸ªstaticå˜é‡ã€‚

## CH2.æ„é€ /ææ„/èµ‹å€¼è¿ç®—

### R05 äº†è§£C++é»˜è®¤ç¼–å†™å¹¶è°ƒç”¨å“ªäº›å‡½æ•°

ç¼–è¯‘å™¨å¯ä»¥æš—è‡ªä¸ºClassåˆ›å»º`defaultæ„é€ å‡½æ•°`ï¼Œ`copyæ„é€ å‡½æ•°(å¤åˆ¶æ„é€ )`ï¼Œ`copy assigment(èµ‹å€¼æ„é€ )æ“ä½œç¬¦`ï¼Œä»¥åŠ`defaultææ„å‡½æ•°`ã€‚
```c++
class EmptyClass{};
```
ç­‰ä»·äº:
```c++
class EmptyClass {
public:
    EmptyClass() {}        // defaultæ„é€ å‡½æ•°
    EmptyClass(const EmptyClass& rhs) {}//copyæ„é€ å‡½æ•°
    ~EmptyClass() {}//defaultææ„å‡½æ•°ï¼Œæ³¨æ„æ˜¯non-virtual
    EmptyClass& operator=(const EmptyClass& rhs) {}//copy assignmentæ“ä½œç¬¦
};
```
- å¦‚æœä¸€ä¸ªéç©ºClassè‡ªè¡Œå£°æ˜äº†æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸å†ä¸ºå®ƒåˆ›å»ºdefaultæ„é€ å‡½æ•°;
- å¦‚æœä¸€ä¸ªClasså†…æœ‰å¼•ç”¨å˜é‡æˆ–constå˜é‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶ç”Ÿæˆcopy-assignmentå‡½æ•°ï¼Œéœ€è¦è‡ªå·±å®ç°.

  ```c++
  class NameObject {
  public:
      NameObject(std::string& name, const int value) :nameValue_(name), objectVal_(value) {}
  private:
      std::string& nameValue_;
      const int objectVal_;
  };//è€ƒè™‘ä»¥ä¸‹åº”ç”¨ä»£ç 
  std::string name("Mike"), name2("Nicky");
  NameObject nObj(name,22), nObj2(name2,33);
  nObj2 = nObj;//è¿™ä¸€å¥ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºå¼•ç”¨ä¸èƒ½æŒ‡å‘2ä¸ªå¯¹è±¡ï¼Œä¸”constä¸å¯æ”¹
  ```

### R06 ä¸æƒ³ç¼–è¯‘å™¨çš„è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°,æ˜ç¡®æ‹’ç»

æŸäº›åœºæ™¯ï¼Œç±»å¯¹è±¡æœ¬èº«æ˜¯è®¤ä¸ºç‹¬ä¸€æ— äºŒçš„ï¼Œæ¯”å¦‚æè¿°äººç‰©æ€§æ ¼çš„ç±»Personality(å¯èƒ½ä¸æ°å½“)ï¼Œä¸åŒçš„äººæ€§æ ¼ä¸åŒï¼Œè‚¯å®šæ˜¯ä¸å¸Œæœ›èƒ½å¤åˆ¶/èµ‹å€¼çš„ã€‚
å¦‚æœä¸æƒ³ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆé‚£å‡ ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ä¸æƒ³è¦å¤åˆ¶æ„é€ æˆ–èµ‹å€¼æ„é€ ï¼Œå°±æ˜ç¡®åœ¨ä»£ç ä¸­ç¦æ­¢ï¼Œä¹Ÿé˜²æ­¢å¤–éƒ¨ç”¨æˆ·ä½¿ç”¨ã€‚

  - æŠ€å·§1ï¼šå¯ä»¥å£°æ˜ä¸ºprivateå‡½æ•°ä½†æ˜¯ä¸ç»™å‡ºå®ç°ï¼Œè®©ç¼–è¯‘å™¨æŠ¥é”™ï¼›
  - æŠ€å·§2ï¼šå¯ä»¥è®¾ç«‹åŸºç±»Baseï¼Œè®©å¤åˆ¶æ„é€ å’Œèµ‹å€¼æ„é€ éƒ½ä¸ºprivateå‡½æ•°ï¼Œè®©ç›®æ ‡ç±»ç»§æ‰¿äºBaseç±»ã€‚

{{<admonition Note "By the way">}}
C++11é’ˆå¯¹æ­¤ç±»æƒ…å†µï¼Œç»™äºˆäº†deleteå…³é”®å­—ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåœ¨æˆå‘˜å‡½æ•°åé¢æ–°å¢"=delete"ï¼Œå³å¯æ˜¾å¼åœ°æ‹’ç»è¿™ä¸ªå‡½æ•°çš„ç”Ÿæˆå’Œè°ƒç”¨.ä¸¾ä¾‹å¦‚ä¸‹:
```c++
class A {
public:
    A(const A&) = delete; // æ‹·è´æ„é€ 
    A& operator=(const A&) = delete; // æ‹·è´èµ‹å€¼
};
```
{{</admonition>}}

### R07 ä¸ºå¤šæ€åŸºç±»å£°æ˜`virtual`ææ„å‡½æ•°

- é’ˆå¯¹`Base* pBase= new DerivedObj()`ï¼Œé‡Šæ”¾pBaseæ—¶ï¼Œå¦‚æœBaseåŸºç±»çš„ææ„å‡½æ•°`None-Virtual`ï¼Œåˆ™ä¼šå¯¼è‡´Derivedçš„ææ„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œé€ æˆ`å†…å­˜ä¸å®Œå…¨é‡Šæ”¾`ï¼Œå³å†…å­˜æ³„æ¼ï¼›
- Non-Virtualçš„Classä¸è¦åšåŸºç±»ï¼›
- å¦‚æœä¸åšåŸºç±»ï¼Œå°±ä¸è¦å£°æ˜ææ„å‡½æ•°ä¸ºvirtualå‡½æ•°ï¼Œé¿å…è™šè¡¨ä¸ºå…¶åˆ†é…vptré€ æˆæµªè´¹ï¼›
- å¦‚æœæƒ³è¦æŠ½è±¡ç±»ï¼Œåˆæš‚æ—¶æ²¡æœ‰åˆé€‚æ¥å£ï¼Œå¯ä»¥è®©å…ˆè™šææ„æˆä¸ºçº¯è™šå‡½æ•°ï¼Œä¾‹å¦‚
  ```c++
  class RawData{
  public:
      virtual ~RawData() = 0;
  };
  // è¿™é‡Œç‰¹æ®Šçš„æ˜¯ï¼Œéœ€è¦ä¸ºè¿™ä¸ªçº¯è™šå‡½æ•°æä¾›å®šä¹‰
  ~RawData::RawData(){}
  ```
### R08 åˆ«è®©å¼‚å¸¸é€ƒç¦»ææ„å‡½æ•°

- ææ„å‡½æ•°æœ€å¥½ä¸è¦åå‡ºå¼‚å¸¸</br>
å¯¹äºæŸä¸ªWidgetç±»ï¼Œå¦‚æœææ„å‡½æ•°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆ`vector<widget>`ææ„æ—¶å¯èƒ½è¿ç»­æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ä»¥è‡³äºæ— æ³•å¤„ç†ï¼Œç›´æ¥å¯¼è‡´æå‰ç¨‹åºç»“æŸæˆ–è€…æœªå®šä¹‰è¡Œä¸ºã€‚

- å¦‚æœæœ‰æŸä¸ªå‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶éœ€è¦å¯¹å¼‚å¸¸åšå‡ºååº”ï¼Œåº”è¯¥æä¾›ä¸€ä¸ªéææ„çš„å‡½æ•°æ¥å¤„ç†</br>
æ³¨æ„ï¼Œåœ¨ææ„ä¸­æŠ›å¼‚å¸¸å¹¶åä¸‹(catchågo-on-execute)ï¼Œä¼šæ©ç›–é”™è¯¯ï¼Œä¹Ÿä¸æ˜¯ä¸ªå¥½åŠæ³•;æŠ›å¼‚å¸¸åcatchä½å¹¶std::abort()åè€Œå¯ä»¥æå‰ç»ˆç»“ã€æœªå®šä¹‰è¡Œä¸ºã€ã€‚

### R09 ç»ä¸åœ¨æ„é€ å’Œææ„è¿‡ç¨‹ä¸­è°ƒç”¨`virtual`å‡½æ•°

- åœ¨Derived-Classçš„Base-Classæ„é€ æœŸé—´ï¼Œå¯¹è±¡çš„ç±»å‹æ˜¯Base-Classï¼Œè€ŒéDerivedï¼Œå³ä½¿`dynamic_cast`ä¹Ÿæ˜¯è¿™æ ·è®¤ä¸ºçš„ï¼Œå› ä¸ºæ­¤æ—¶virtualå‡½æ•°ä¸ä¼šä¸‹é™åˆ°Derived-Classçš„é˜¶å±‚ï¼›æ¢å¥è¯è¯´==> â€œ`åœ¨Base-Classæ„é€ æœŸé—´ï¼Œvirtualå‡½æ•°ä¸æ˜¯virtualå‡½æ•°`â€ï¼›
- åœ¨ææ„çš„æ—¶å€™ä¹Ÿæ˜¯ç±»ä¼¼é“ç†ï¼Œä¹Ÿä¸è¦åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨virtualå‡½æ•°ï¼Œé—´æ¥è°ƒç”¨ä¹Ÿä¸è¡Œ(æ¯”å¦‚non-Virtual->virtual)ï¼›
- é‚£ä¹ˆæ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼Ÿ</br>
  å¦‚æœæœ‰è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå¸Œæœ›åœ¨å­ç±»æ„é€ æ—¶èƒ½è°ƒç”¨çˆ¶ç±»çš„fooå‡½æ•°(ä¸‹æ–¹logTransactionå‡½æ•°)ï¼Œé‚£ä¹ˆå°†fooæ”¹ä¸ºnon-Virtualå‡½æ•°ï¼Œå¹¶ä¸”å­ç±»æ„é€ æ—¶è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œæœ‰å‚æ•°æ—¶ä¸€å¹¶ä¼ è¿‡å»ï¼›
```c++
class Transaction {
public:
    explict Transaction(const std::string& info,int id):id_(id) { logTransaction(info); }
    void logTransaction(const std::string& info) {
        std::cout << info.c_str(); }//non-Virtualå‡½æ•°
private:
    int id_;
};

class BuyTransaction :public Transaction {
public:  //å°†logä¿¡æ¯ä¼ é€’ç»™ åŸºç±»Transactionæ„é€ å‡½æ•°ï¼› å¹¶åˆå§‹åŒ–äº†åŸºç±»æˆå‘˜
    BuyTransaction(const std::string& info, int id)
        :Transaction(info,id) {/**/}
};
```
{{<admonition Note "By the way">}}
ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœæœ‰å‡ ä¸ªBaseæ„é€ å‡½æ•°ï¼Œå°±å¾—å†™å‡ ä¸ªDerivedæ„é€ å‡½æ•°ä¼ å‚ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸€æ­¥éª¤ï¼Œ åœ¨ç°ä»£C++11ï¼Œæ¨å‡ºäº†ç»§æ‰¿æ„é€ å‡½æ•°(Inheriting Constructor)ï¼Œå­ç±»å¯ä»¥ä¸€ä¸ªéƒ½ä¸ç”¨å†™ï¼Œç›´æ¥å†™ä¸€å¥usingå£°æ˜å³å¯ï¼Œä½¿ç”¨`using BaseClass::BaseClass`çš„å½¢å¼ï¼Œå¦‚ä¸‹ğŸ‘‡
```c++
class BuyTransaction :public Transaction {
public:
  using Transaction::Transaction;
  //å…¶ä»–
};
```
{{</admonition>}}


### R10 ä»¤`operator=`è¿”å›ä¸€ä¸ªreference to *this

- å…³äºèµ‹å€¼æ“ä½œç¬¦`operator=`ï¼Œä¸»æµåšæ³•æ˜¯:
  ```c++
  class Widget {
  public:
      Widget& operator=(const Widget &rhs) {
        //... do some thing
          return *this;
      }
  };
  ```
  ä¸Šè¿°åšæ³•ä¸å±€é™äºoperator=ï¼Œè¿˜æœ‰`operator += ,-=,*=,/=`ç­‰å…¶ä»–èµ‹å€¼è¿ç®—ç¬¦ã€‚</br>
  è¯¥ä¸»æµåè®®/åšæ³•ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œåªæ˜¯ä¸ªå»ºè®®ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å…è®¸**è¿ç»­èµ‹å€¼**($x=y=z$çš„å½¢å¼)ã€‚</br>
  è¯¥åè®®è¢«å†…ç½®ç±»å‹ï¼Œä»¥åŠSTLçš„ç±»å‹(å¦‚string,vector,complex,shared_ptr)å…±åŒéµå®ˆã€‚</br>

### R11 åœ¨`operator=`ä¸­å¤„ç†"è‡ªæˆ‘èµ‹å€¼"

ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™è‡ªå·±ï¼Œè¿™ç§çœ‹èµ·æ¥æœ‰ç‚¹å‚»çš„åšæ³•ï¼Œæœ‰æ—¶å€™ä¼šæ¯”è¾ƒéš¾ä»¥å‘è§‰ã€‚æ¯”å¦‚ï¼š`a[i] = a[j]`ï¼Œå¦‚æœ $i$ å’Œ $j$ ç›¸ç­‰ï¼Œå°±æ˜¯â€œè‡ªæˆ‘èµ‹å€¼â€çš„ç»å…¸åœºæ™¯äº†ã€‚
æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå°½é‡å®Œå¤‡çš„èµ‹å€¼æ“ä½œç¬¦å‡½æ•°ğŸ¤”ã€‚
è€ƒè™‘å¦‚ä¸‹ç±»`MapWidget`ï¼Œå†…æœ‰æ•°æ®è£¸æŒ‡é’ˆ`BitMap *pb_`ï¼Œåœ¨èµ‹å€¼æ—¶åŒæ—¶è€ƒè™‘**å¼‚å¸¸å®‰å…¨**å’Œ **â€œè‡ªæˆ‘èµ‹å€¼â€** å®‰å…¨(è®¤åŒæµ‹è¯•ä¿éšœè‡ªæˆ‘èµ‹å€¼å®‰å…¨)ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹ä¸é”™çš„å®ç°ã€‚ä½†æ˜¯ï¼Œè®¤åŒæµ‹è¯•ä¼šé™ä½è¿è¡Œæ•ˆç‡ï¼Œæ ¹æ®å®é™…å·¥ç¨‹å®è·µæƒ…å†µ(è‡ªæˆ‘èµ‹å€¼æ¦‚ç‡æä½ )å¯ä»¥é…Œæƒ…å»æ‰ã€‚

```c++
class BitMap {/*çœç•¥ç±»å£°æ˜&å®ç°*/};
class MapWidget {
private:
    BitMap * pb_ = nullptr;
public:
    explicit MapWidget(BitMap *pb) :pb_(pb) {}
    MapWidget& operator=(const MapWidget& rhs) {
        if (this == &rhs) return *this; //è¿™ä¸€å¥ä¸ºè®¤åŒæµ‹è¯•(identity test)
        BitMap *pOrig = pb_;//ä¸è¦ä¸€ä¸Šæ¥å°±deleteï¼Œè€Œæ˜¯ä¿å­˜this->pb_
        pb_ = new BitMap(*rhs.pb_);//å› ä¸ºè¿™ä¸€å¥å¯èƒ½æŠ›å¼‚å¸¸
        delete pOrig;
        return *this;
    }
};
```
- Copy and SwapæŠ€æœ¯ ä¸Šæ–‡ä¸­ä¿éšœ**å¼‚å¸¸å®‰å…¨**å’Œ **â€œè‡ªæˆ‘èµ‹å€¼â€**å®‰å…¨çš„æŠ€æœ¯æ‰‹æ®µï¼Œå¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯Copy and SwapæŠ€æœ¯ã€‚è¿™ä¸ªæŠ€æœ¯çš„å…³é”®åœ¨äºâ€œä¿®æ”¹å¯¹è±¡æ•°æ®çš„å‰¯æœ¬ï¼Œç„¶ååœ¨ä¸€ä¸ªä¸æŠ›å¼‚å¸¸çš„å‡½æ•°ä¸­å°†ä¿®æ”¹çš„æ•°æ®å’ŒåŸä»¶ç½®æ¢ â€ã€‚
  ```c++
  void MapWidget::Swap(MapWidget& rhs){std::swap(rhs.pb_,pb_);}
  MapWidget& MapWidget::operator=(const MapWidget& rhs) {
      MapWidget temp(rhs);
      Swap(temp);
      return *this;
  }
  ```

### R12 å¤åˆ¶å¯¹è±¡æ—¶åˆ«å¿˜è®°å…¶æ¯ä¸€ä¸ªæˆåˆ†

- ç¼–å†™ç±»çš„Copyingå‡½æ•°æ—¶éœ€è¦åšåˆ°2ç‚¹
è¿™é‡Œçš„Copyingå‡½æ•°æ˜¯æŒ‡æœ‰copyå±æ€§çš„ç‰¹æ®Šå‡½æ•°==> copyæ„é€ å‡½æ•°å’Œcopyèµ‹å€¼æ“ä½œç¬¦ã€‚

  1. å¤åˆ¶æ‰€æœ‰Localæˆå‘˜å˜é‡
     å¦‚æœæˆå‘˜å¤åˆ¶çš„æ—¶å€™æœ‰é—æ¼ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæœ‰æ€¨è¨€ï¼Œè¿™å°±åŸ‹ä¸‹äº†éšæ‚£ã€‚å¦‚æœæ–°å¢äº†æˆå‘˜ï¼Œè¦å¯¹åº”ä¿®æ”¹Copyingå‡½æ•°ã€‚
  2. è°ƒç”¨æ‰€æœ‰Base-Classå†…éƒ¨çš„é€‚å½“çš„Copyå‡½æ•°
     å…·ä½“ä»£ç çš„æ¨èå®ç° å¦‚ä¸‹ğŸ‘‡ï¼š
  ```c++
  class Customer {
  public:
      Customer(std::string name, float money):name_(name),money_(money) {}
  private:
      std::string name_;
      float money_;
  };

  class VipCustomer :public Customer {
  public:  //æ³¨æ„ï¼šæ´¾ç”Ÿç±»è¦å¤åˆ¶åŸºç±»é‚£éƒ¨åˆ†çš„æˆå‘˜å˜é‡
      using Customer::Customer; //å‚è€ƒR09
      VipCustomer(const VipCustomer& rhs)
          :priority_(rhs.priority_),Customer(rhs){}
      VipCustomer& operator=(const VipCustomer& rhs){
          Customer::operator=(rhs);
          priority_ = rhs.priority_;
          return *this;
      }
      void setPriority(int priority) { priority_ = priority; };
  private:
      int priority_;//å­ç±»ç‹¬æœ‰æˆå‘˜å¯ä»¥å•ç‹¬setå‡½æ•°èµ‹å€¼ï¼Œæˆ–è€…æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨èµ‹å€¼
  };
  ```

- ä¸è¦ç”¨ä¸€ä¸ªCopyingå‡½æ•°å»å®ç°å¦ä¸€ä¸ª
ä»¤copy-assignmentæ“ä½œç¬¦è°ƒç”¨copyæ„é€ å‡½æ•°æ˜¯ä¸åˆç†çš„ï¼›åä¹‹ï¼Œåè€…è°ƒç”¨å‰è€…ä¹Ÿæ˜¯æ— æ„ä¹‰çš„ã€‚ å¦‚æœ2è€…æœ‰å¤§é‡çš„ä»£ç æ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥å‰¥ç¦»ä¸€ä¸ªç±»å†…privateç±»å‹çš„`init`å‡½æ•°å‡ºæ¥ï¼Œæä¾›ç»™ä¸Šè¿°2è€…è°ƒç”¨ã€‚

## ref:</br>
[1]. https://blog.csdn.net/cltcj/category_12098441.html</br>
[2]. https://kissingfire123.github.io/2021/12/06_effective-c-%e4%b9%8b%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93%e4%b8%80/</br>